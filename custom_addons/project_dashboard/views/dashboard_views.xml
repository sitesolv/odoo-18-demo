<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Dashboard Form View -->
    <record id="view_project_dashboard_form" model="ir.ui.view">
        <field name="name">project.dashboard.analytics.form</field>
        <field name="model">project.dashboard.analytics</field>
        <field name="arch" type="xml">
            <form string="Project Dashboard" create="false" delete="false">
                <header>
                    <button name="action_refresh" string="Refresh Data" type="object" class="oe_highlight"/>
                    <!-- Alert for urgent expiries -->
                    <div class="alert alert-warning" role="alert" invisible="urgent_domains_count == 0 and urgent_hosting_count == 0" style="margin: 10px 0;">
                        <strong>⚠️ Urgent Attention Required!</strong>
                        <span invisible="urgent_domains_count == 0">
                            <field name="urgent_domains_count"/> domain(s) require immediate attention.
                        </span>
                        <span invisible="urgent_hosting_count == 0">
                            <field name="urgent_hosting_count"/> hosting service(s) require immediate attention.
                        </span>
                    </div>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name" readonly="1"/></h1>
                    </div>
                    
                    <!-- Date Filter -->
                    <group name="date_filter" string="Date Filter">
                        <field name="date_from"/>
                        <field name="date_to"/>
                    </group>
                    
                    <!-- KPI Section -->
                    <div class="oe_dashboard">
                        <div class="oe_dashboard_section">
                            <div class="oe_dashboard_column">
                                <!-- Project KPIs -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">Project Overview</div>
                                    <div class="oe_dashboard_item">
                                        <table class="oe_dashboard_table">
                                            <tr>
                                                <td class="oe_dashboard_table_label">Total Projects:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="total_projects" widget="integer"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Ongoing Projects:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="ongoing_projects" widget="integer"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Completed Projects:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="completed_projects" widget="integer"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="oe_dashboard_column">
                                <!-- Financial KPIs -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">Financial Overview</div>
                                    <div class="oe_dashboard_item">
                                        <table class="oe_dashboard_table">
                                            <tr>
                                                <td class="oe_dashboard_table_label">Total Income:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="total_income" widget="monetary"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Total Expenses:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="total_expenses" widget="monetary"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Net Profit:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <field name="net_profit" widget="monetary"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="oe_dashboard_column">
                                <!-- Top Customers -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">Top Customers</div>
                                    <div class="oe_dashboard_item">
                                        <field name="top_customer_ids" widget="many2many_tags" readonly="1"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expiry Notifications Section -->
                        <div class="oe_dashboard_section">
                            <div class="oe_dashboard_column">
                                <!-- Expiring Domains -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">⚠️ Domain Expiry Status</div>
                                    <div class="oe_dashboard_item">
                                        <table class="oe_dashboard_table">
                                            <tr>
                                                <td class="oe_dashboard_table_label">Total Expiring:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <button name="action_view_expiring_domains" type="object" class="btn btn-link oe_stat_button" style="color: #f39c12;">
                                                        <field name="expiring_domains_count" widget="integer"/>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Urgent/Expired:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <button name="action_view_urgent_domains" type="object" class="btn btn-link oe_stat_button" style="color: #e74c3c;">
                                                        <field name="urgent_domains_count" widget="integer"/>
                                                    </button>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="oe_dashboard_column">
                                <!-- Expiring Hosting -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">⚠️ Hosting Expiry Status</div>
                                    <div class="oe_dashboard_item">
                                        <table class="oe_dashboard_table">
                                            <tr>
                                                <td class="oe_dashboard_table_label">Total Expiring:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <button name="action_view_expiring_hosting" type="object" class="btn btn-link oe_stat_button" style="color: #f39c12;">
                                                        <field name="expiring_hosting_count" widget="integer"/>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="oe_dashboard_table_label">Urgent/Expired:</td>
                                                <td class="oe_dashboard_table_value">
                                                    <button name="action_view_urgent_hosting" type="object" class="btn btn-link oe_stat_button" style="color: #e74c3c;">
                                                        <field name="urgent_hosting_count" widget="integer"/>
                                                    </button>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="oe_dashboard_column">
                                <!-- Quick Actions -->
                                <div class="oe_dashboard_column_content">
                                    <div class="oe_dashboard_column_title">🚀 Quick Actions</div>
                                    <div class="oe_dashboard_item">
                                        <div style="text-align: center; padding: 10px;">
                                            <button name="action_view_expiring_domains" type="object" class="btn btn-warning btn-sm" style="margin: 5px; width: 100%;">
                                                View All Expiring Domains
                                            </button>
                                            <button name="action_view_expiring_hosting" type="object" class="btn btn-warning btn-sm" style="margin: 5px; width: 100%;">
                                                View All Expiring Hosting
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Dashboard Action -->
    <record id="action_project_dashboard" model="ir.actions.act_window">
        <field name="name">Project Dashboard</field>
        <field name="res_model">project.dashboard.analytics</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <field name="context">{}</field>
    </record>

    <!-- Direct Dashboard Action (without wizard) -->
    <record id="action_project_dashboard_direct" model="ir.actions.server">
        <field name="name">Project Dashboard</field>
        <field name="model_id" ref="model_project_dashboard_analytics"/>
        <field name="state">code</field>
        <field name="code">
# Use datetime.date.today() directly (no import allowed)
today = datetime.date.today()
dashboard = env['project.dashboard.analytics'].search([], limit=1)
if not dashboard:
    dashboard = env['project.dashboard.analytics'].create({
        'name': 'Project Analytics Dashboard',
        'date_from': today.replace(day=1),
        'date_to': today,
    })
else:
    dashboard.write({
        'date_from': today.replace(day=1),
        'date_to': today,
    })
action = {
    'type': 'ir.actions.act_window',
    'name': 'Project Dashboard',
    'res_model': 'project.dashboard.analytics',
    'res_id': dashboard.id,
    'view_mode': 'form',
    'target': 'current',
}
        </field>
    </record>

    <!-- Dashboard Wizard Form -->
    <record id="view_project_dashboard_wizard_form" model="ir.ui.view">
        <field name="name">project.dashboard.analytics.wizard.form</field>
        <field name="model">project.dashboard.analytics.wizard</field>
        <field name="arch" type="xml">
            <form string="Project Dashboard">
                <sheet>
                    <div class="oe_title">
                        <h1>Project Dashboard</h1>
                        <p>Select date range for analytics</p>
                    </div>
                    <group>
                        <field name="date_from"/>
                        <field name="date_to"/>
                    </group>
                </sheet>
                <footer>
                    <button name="action_view_dashboard" string="View Dashboard" type="object" class="oe_highlight"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Dashboard Wizard Action -->
    <record id="action_project_dashboard_wizard" model="ir.actions.act_window">
        <field name="name">Project Dashboard</field>
        <field name="res_model">project.dashboard.analytics.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>
</odoo>
