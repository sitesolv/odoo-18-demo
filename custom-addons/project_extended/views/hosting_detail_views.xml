<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Hosting Detail Tree View -->
        <record id="view_hosting_detail_tree" model="ir.ui.view">
            <field name="name">project.hosting.tree</field>
            <field name="model">project.hosting</field>
            <field name="arch" type="xml">
                <list string="Hosting Services" decoration-warning="expiry_status == 'warning'" decoration-danger="expiry_status in ['urgent', 'expired']">
                    <field name="name"/>
                    <field name="provider"/>
                    <field name="project_id"/>
                    <field name="client_id"/>
                    <field name="bought_date"/>
                    <field name="expiry_date"/>
                    <field name="days_to_expiry"/>
                    <field name="expiry_status" widget="badge" decoration-success="expiry_status == 'valid'" decoration-warning="expiry_status == 'warning'" decoration-danger="expiry_status in ['urgent', 'expired']"/>
                    <field name="cost"/>
                    <field name="reminder_sent" invisible="1"/>
                    <button name="%(project_extended.action_remind_hosting_client)d" string="üì® Remind" type="action" class="btn-link text-primary" invisible="expiry_status not in ['warning', 'urgent', 'expired'] or not client_id or not client_id.email" title="Send reminder email to client"/>
                </list>
            </field>
        </record>

        <!-- Hosting Detail Form View -->
        <record id="view_hosting_detail_form" model="ir.ui.view">
            <field name="name">project.hosting.form</field>
            <field name="model">project.hosting</field>
            <field name="arch" type="xml">
                <form string="Hosting Details">
                    <script type="text/javascript">
                        <![CDATA[
                        setTimeout(function() {
                            document.addEventListener('click', function(e) {
                                if (e.target && e.target.classList.contains('o_toggle_password')) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    
                                    const passwordDiv = e.target.parentElement;
                                    const passwordField = passwordDiv.querySelector('.o_password_field input');
                                    
                                    if (passwordField) {
                                        if (passwordField.type === 'password') {
                                            passwordField.type = 'text';
                                            e.target.textContent = 'üôà';
                                        } else {
                                            passwordField.type = 'password';
                                            e.target.textContent = 'üëÅÔ∏è';
                                        }
                                    }
                                }
                            });
                        }, 500);
                        ]]>
                    </script>
                    <header>
                        <button name="%(project_extended.action_remind_hosting_client)d" string="üì® Remind Client" type="action" class="btn-primary" invisible="expiry_status not in ['warning', 'urgent', 'expired'] or not client_id or not client_id.email"/>
                        <field name="expiry_status" widget="statusbar" statusbar_visible="valid,warning,urgent,expired"/>
                    </header>
                    <sheet>
                        <div class="alert alert-danger" role="alert" invisible="expiry_status not in ['urgent', 'expired']">
                            <strong>
                                <span invisible="expiry_status != 'expired'">
                                    ‚ö†Ô∏è URGENT: This hosting service has expired!
                                </span>
                                <span invisible="expiry_status != 'urgent'">
                                    ‚ö†Ô∏è URGENT: This hosting service expires in 3 days or less!
                                </span>
                            </strong>
                        </div>
                        <div class="alert alert-warning" role="alert" invisible="expiry_status != 'warning'">
                            <strong>‚ö†Ô∏è WARNING: This hosting service expires within a week!</strong>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Hosting Service Provider..."/>
                            </h1>
                        </div>
                        <group>
                            <group string="Hosting Information">
                                <field name="provider"/>
                                <field name="project_id" options="{'no_create': True}"/>
                                <field name="client_id"/>
                                <field name="bought_date"/>
                                <field name="expiry_date"/>
                                <field name="days_to_expiry"/>
                                <field name="cost"/>
                            </group>
                            <group string="Access Information">
                                <field name="username"/>
                                <label for="password" string="Password"/>
                                <div class="o_row">
                                    <field name="password" password="True" class="o_password_field" nolabel="1"/>
                                    <span class="btn btn-sm btn-outline-secondary o_toggle_password" title="Show/Hide Password" style="cursor: pointer; user-select: none;">üëÅÔ∏è</span>
                                </div>
                            </group>
                        </group>
                        <group string="Additional Information">
                            <field name="description" nolabel="1" placeholder="Enter any additional notes or information about this hosting service..."/>
                        </group>
                        <group string="Notification Status" groups="base.group_no_one">
                            <field name="reminder_sent"/>
                            <field name="urgent_notification"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Hosting Detail Search View -->
        <record id="view_hosting_detail_search" model="ir.ui.view">
            <field name="name">project.hosting.search</field>
            <field name="model">project.hosting</field>
            <field name="arch" type="xml">
                <search string="Search Hosting Services">
                    <field name="name"/>
                    <field name="provider"/>
                    <field name="project_id"/>
                    <field name="client_id"/>
                    <filter string="Expired" name="expired" domain="[('expiry_status', '=', 'expired')]"/>
                    <filter string="Urgent (‚â§3 days)" name="urgent" domain="[('expiry_status', '=', 'urgent')]"/>
                    <filter string="Warning (‚â§7 days)" name="warning" domain="[('expiry_status', '=', 'warning')]"/>
                    <filter string="Valid" name="valid" domain="[('expiry_status', '=', 'valid')]"/>
                    <separator/>
                    <filter string="This Month" name="this_month" 
                            domain="[('expiry_date', '&gt;=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                                     ('expiry_date', '&lt;', (context_today() + relativedelta(months=1, day=1)).strftime('%Y-%m-%d'))]"/>
                    <group expand="0" string="Group By">
                        <filter string="Project" name="group_project" context="{'group_by': 'project_id'}"/>
                        <filter string="Provider" name="group_provider" context="{'group_by': 'provider'}"/>
                        <filter string="Status" name="group_status" context="{'group_by': 'expiry_status'}"/>
                        <filter string="Expiry Month" name="group_expiry_month" context="{'group_by': 'expiry_date:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Hosting Detail Action -->
        <record id="action_hosting_detail" model="ir.actions.act_window">
            <field name="name">Hosting Services</field>
            <field name="res_model">project.hosting</field>
            <field name="view_mode">list,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first hosting service!
                </p>
                <p>
                    Track your hosting services with expiry dates and get notifications when they're about to expire.
                </p>
            </field>
        </record>

        <!-- Expiring Hosting Action -->
        <record id="action_expiring_hosting" model="ir.actions.act_window">
            <field name="name">‚ö†Ô∏è Expiring Hosting Services</field>
            <field name="res_model">project.hosting</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('expiry_status', 'in', ['warning', 'urgent', 'expired'])]</field>
            <field name="context">{'search_default_urgent': 1, 'search_default_warning': 1, 'search_default_expired': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No expiring hosting services found!
                </p>
                <p>
                    All your hosting services are up to date. Great job!
                </p>
            </field>
        </record>

        <!-- Hosting Action for Project Context -->
        <record id="action_project_hosting_form" model="ir.actions.act_window">
            <field name="name">Hosting Service Details</field>
            <field name="res_model">project.hosting</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hosting_detail_form"/>
            <field name="target">new</field>
            <field name="context">{'default_project_id': active_id}</field>
        </record>

    </data>
</odoo>
