<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Domain Remind Client Action -->
        <record id="action_remind_domain_client" model="ir.actions.server">
            <field name="name">Remind Domain Client</field>
            <field name="model_id" ref="project_extended.model_project_domain"/>
            <field name="state">code</field>
            <field name="code">
# Get the domain record
domain = record

# Check if client has email
if not domain.client_id.email:
    raise UserError(f"Client {domain.client_id.name} has no email address configured.")

# Get company information
company = env.company
company_email = company.email or env.user.email or 'info@yourcompany.com'
company_name = company.name or 'Your Company'

# Format expiry date
expiry_date_formatted = domain.expiry_date.strftime('%B %d, %Y')

# Build email content based on expiry status
if domain.expiry_status in ['urgent', 'expired']:
    # Urgent/Expired email
    subject = f"üö® URGENT: Your Domain \"{domain.name}\" Has Expired!"
    
    if domain.expiry_status == 'expired':
        days_message = f"Days overdue: {abs(domain.days_to_expiry)} days"
        status_message = f"‚ö†Ô∏è Your domain \"{domain.name}\" expired on {expiry_date_formatted}"
        urgent_message = "IMMEDIATE ACTION REQUIRED! Your domain has expired and may cause website downtime."
    else:
        days_message = f"Days remaining: {domain.days_to_expiry} days"
        status_message = f"‚ö†Ô∏è Your domain \"{domain.name}\" expires on {expiry_date_formatted}"
        urgent_message = "URGENT: Your domain expires in 3 days or less!"
    
    # Build HTML using string concatenation to avoid XML issues
    body_html = "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;"
    body_html += "&lt;meta charset=\"utf-8\"&gt;"
    body_html += "&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;"
    body_html += "&lt;title&gt;URGENT: Domain Alert&lt;/title&gt;&lt;/head&gt;"
    body_html += "&lt;body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;\"&gt;"
    body_html += "&lt;table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f4f4f4; padding: 20px;\"&gt;"
    body_html += "&lt;tr&gt;&lt;td align=\"center\"&gt;"
    body_html += "&lt;table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\"&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #dc3545; color: white; padding: 30px; text-align: center;\"&gt;"
    body_html += "&lt;h1 style=\"margin: 0; font-size: 24px;\"&gt;üö® URGENT: Domain Alert&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"padding: 30px;\"&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin-bottom: 20px; color: #333;\"&gt;Dear &lt;strong&gt;{domain.client_id.name}&lt;/strong&gt;,&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += f"&lt;p style=\"margin: 0; font-size: 16px; color: #721c24;\"&gt;&lt;strong&gt;{status_message}&lt;/strong&gt;&lt;/p&gt;"
    body_html += f"&lt;p style=\"margin: 10px 0 0 0; font-size: 14px; color: #721c24;\"&gt;{days_message}&lt;/p&gt;&lt;/div&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin: 20px 0; color: #dc3545;\"&gt;&lt;strong&gt;{urgent_message}&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"font-size: 16px; margin: 20px 0; color: #333;\"&gt;Please contact us immediately to renew your domain.&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #fff3cd; padding: 25px; border: 2px solid #ffc107;\"&gt;"
    body_html += "&lt;h3 style=\"color: #856404; margin: 0 0 15px 0; font-size: 18px;\"&gt;üÜò URGENT CONTACT REQUIRED:&lt;/h3&gt;"
    body_html += f"&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üìß Email:&lt;/strong&gt; &lt;a href=\"mailto:{company_email}\" style=\"color: #dc3545; text-decoration: none; font-weight: bold;\"&gt;{company_email}&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üì± Mobile:&lt;/strong&gt; &lt;a href=\"tel:0762682176\" style=\"color: #dc3545; text-decoration: none; font-weight: bold;\"&gt;0762682176&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #dee2e6;\"&gt;"
    body_html += f"&lt;p style=\"color: #6c757d; font-size: 14px; margin: 0;\"&gt;Urgent regards,&lt;br/&gt;&lt;strong&gt;{company_name} Team&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"
else:
    # Warning email
    subject = f"‚ö†Ô∏è Important: Your Domain \"{domain.name}\" is Expiring Soon"
    
    body_html = "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;"
    body_html += "&lt;meta charset=\"utf-8\"&gt;"
    body_html += "&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;"
    body_html += "&lt;title&gt;Domain Expiry Notice&lt;/title&gt;&lt;/head&gt;"
    body_html += "&lt;body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;\"&gt;"
    body_html += "&lt;table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f4f4f4; padding: 20px;\"&gt;"
    body_html += "&lt;tr&gt;&lt;td align=\"center\"&gt;"
    body_html += "&lt;table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\"&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f39c12; color: white; padding: 30px; text-align: center;\"&gt;"
    body_html += "&lt;h1 style=\"margin: 0; font-size: 24px;\"&gt;‚ö†Ô∏è Domain Expiry Notice&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"padding: 30px;\"&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin-bottom: 20px; color: #333;\"&gt;Dear &lt;strong&gt;{domain.client_id.name}&lt;/strong&gt;,&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += f"&lt;p style=\"margin: 0; font-size: 16px; color: #856404;\"&gt;&lt;strong&gt;Your domain \"{domain.name}\" expires on {expiry_date_formatted}&lt;/strong&gt;&lt;/p&gt;"
    body_html += f"&lt;p style=\"margin: 10px 0 0 0; font-size: 14px; color: #856404;\"&gt;Days remaining: &lt;strong&gt;{domain.days_to_expiry} days&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;"
    body_html += "&lt;p style=\"font-size: 16px; margin: 20px 0; color: #333;\"&gt;Please renew your domain before the expiry date.&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += "&lt;p style=\"margin: 0; font-size: 16px; color: #721c24;\"&gt;&lt;strong&gt;Please renew quickly to avoid website downtime!&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #e3f2fd; padding: 25px;\"&gt;"
    body_html += "&lt;h3 style=\"color: #1976d2; margin: 0 0 15px 0; font-size: 18px;\"&gt;üìû Need Assistance? Contact Us:&lt;/h3&gt;"
    body_html += f"&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üìß Email:&lt;/strong&gt; &lt;a href=\"mailto:{company_email}\" style=\"color: #1976d2; text-decoration: none;\"&gt;{company_email}&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üì± Mobile:&lt;/strong&gt; &lt;a href=\"tel:0762682176\" style=\"color: #1976d2; text-decoration: none;\"&gt;0762682176&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #dee2e6;\"&gt;"
    body_html += f"&lt;p style=\"color: #6c757d; font-size: 14px; margin: 0;\"&gt;Best regards,&lt;br/&gt;&lt;strong&gt;{company_name} Team&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"

# Open email composer with pre-built content
action = {
    'type': 'ir.actions.act_window',
    'name': 'Send Reminder Email',
    'res_model': 'mail.compose.message',
    'view_mode': 'form',
    'target': 'new',
    'context': {
        'default_model': 'project.domain',
        'default_res_ids': [domain.id],
        'default_partner_ids': [(6, 0, [domain.client_id.id])],
        'default_subject': subject,
        'default_body': body_html,
        'default_email_from': company_email,
        'default_email_to': domain.client_id.email,
        'default_composition_mode': 'comment',
    }
}
            </field>
        </record>

        <!-- Hosting Remind Client Action -->
        <record id="action_remind_hosting_client" model="ir.actions.server">
            <field name="name">Remind Hosting Client</field>
            <field name="model_id" ref="project_extended.model_project_hosting"/>
            <field name="state">code</field>
            <field name="code">
# Get the hosting record
hosting = record

# Check if client has email
if not hosting.client_id.email:
    raise UserError(f"Client {hosting.client_id.name} has no email address configured.")

# Get company information
company = env.company
company_email = company.email or env.user.email or 'info@yourcompany.com'
company_name = company.name or 'Your Company'

# Format expiry date
expiry_date_formatted = hosting.expiry_date.strftime('%B %d, %Y')

# Build email content based on expiry status
if hosting.expiry_status in ['urgent', 'expired']:
    # Urgent/Expired email
    subject = f"üö® URGENT: Your Hosting Service \"{hosting.name}\" Has Expired!"
    
    if hosting.expiry_status == 'expired':
        days_message = f"Days overdue: {abs(hosting.days_to_expiry)} days"
        status_message = f"‚ö†Ô∏è Your hosting service \"{hosting.name}\" ({hosting.provider}) expired on {expiry_date_formatted}"
        urgent_message = "IMMEDIATE ACTION REQUIRED! Your hosting service has expired and your website may be offline."
    else:
        days_message = f"Days remaining: {hosting.days_to_expiry} days"
        status_message = f"‚ö†Ô∏è Your hosting service \"{hosting.name}\" ({hosting.provider}) expires on {expiry_date_formatted}"
        urgent_message = "URGENT: Your hosting service expires in 3 days or less!"
    
    # Build HTML using string concatenation to avoid XML issues
    body_html = "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;"
    body_html += "&lt;meta charset=\"utf-8\"&gt;"
    body_html += "&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;"
    body_html += "&lt;title&gt;URGENT: Hosting Alert&lt;/title&gt;&lt;/head&gt;"
    body_html += "&lt;body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;\"&gt;"
    body_html += "&lt;table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f4f4f4; padding: 20px;\"&gt;"
    body_html += "&lt;tr&gt;&lt;td align=\"center\"&gt;"
    body_html += "&lt;table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\"&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #dc3545; color: white; padding: 30px; text-align: center;\"&gt;"
    body_html += "&lt;h1 style=\"margin: 0; font-size: 24px;\"&gt;üö® URGENT: Hosting Alert&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"padding: 30px;\"&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin-bottom: 20px; color: #333;\"&gt;Dear &lt;strong&gt;{hosting.client_id.name}&lt;/strong&gt;,&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += f"&lt;p style=\"margin: 0; font-size: 16px; color: #721c24;\"&gt;&lt;strong&gt;{status_message}&lt;/strong&gt;&lt;/p&gt;"
    body_html += f"&lt;p style=\"margin: 10px 0 0 0; font-size: 14px; color: #721c24;\"&gt;{days_message}&lt;/p&gt;&lt;/div&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin: 20px 0; color: #dc3545;\"&gt;&lt;strong&gt;{urgent_message}&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"font-size: 16px; margin: 20px 0; color: #333;\"&gt;Please contact us immediately to renew your hosting service.&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #fff3cd; padding: 25px; border: 2px solid #ffc107;\"&gt;"
    body_html += "&lt;h3 style=\"color: #856404; margin: 0 0 15px 0; font-size: 18px;\"&gt;üÜò URGENT CONTACT REQUIRED:&lt;/h3&gt;"
    body_html += f"&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üìß Email:&lt;/strong&gt; &lt;a href=\"mailto:{company_email}\" style=\"color: #dc3545; text-decoration: none; font-weight: bold;\"&gt;{company_email}&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üì± Mobile:&lt;/strong&gt; &lt;a href=\"tel:0762682176\" style=\"color: #dc3545; text-decoration: none; font-weight: bold;\"&gt;0762682176&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #dee2e6;\"&gt;"
    body_html += f"&lt;p style=\"color: #6c757d; font-size: 14px; margin: 0;\"&gt;Urgent regards,&lt;br/&gt;&lt;strong&gt;{company_name} Team&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"
else:
    # Warning email
    subject = f"‚ö†Ô∏è Important: Your Hosting Service \"{hosting.name}\" is Expiring Soon"
    
    body_html = "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;"
    body_html += "&lt;meta charset=\"utf-8\"&gt;"
    body_html += "&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;"
    body_html += "&lt;title&gt;Hosting Expiry Notice&lt;/title&gt;&lt;/head&gt;"
    body_html += "&lt;body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;\"&gt;"
    body_html += "&lt;table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f4f4f4; padding: 20px;\"&gt;"
    body_html += "&lt;tr&gt;&lt;td align=\"center\"&gt;"
    body_html += "&lt;table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\"&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f39c12; color: white; padding: 30px; text-align: center;\"&gt;"
    body_html += "&lt;h1 style=\"margin: 0; font-size: 24px;\"&gt;‚ö†Ô∏è Hosting Expiry Notice&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"padding: 30px;\"&gt;"
    body_html += f"&lt;p style=\"font-size: 16px; margin-bottom: 20px; color: #333;\"&gt;Dear &lt;strong&gt;{hosting.client_id.name}&lt;/strong&gt;,&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += f"&lt;p style=\"margin: 0; font-size: 16px; color: #856404;\"&gt;&lt;strong&gt;Your hosting service \"{hosting.name}\" ({hosting.provider}) expires on {expiry_date_formatted}&lt;/strong&gt;&lt;/p&gt;"
    body_html += f"&lt;p style=\"margin: 10px 0 0 0; font-size: 14px; color: #856404;\"&gt;Days remaining: &lt;strong&gt;{hosting.days_to_expiry} days&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;"
    body_html += "&lt;p style=\"font-size: 16px; margin: 20px 0; color: #333;\"&gt;Please renew your hosting service before the expiry date.&lt;/p&gt;"
    body_html += "&lt;div style=\"background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 20px 0; border-radius: 4px;\"&gt;"
    body_html += "&lt;p style=\"margin: 0; font-size: 16px; color: #721c24;\"&gt;&lt;strong&gt;Please renew quickly to avoid website downtime!&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #e3f2fd; padding: 25px;\"&gt;"
    body_html += "&lt;h3 style=\"color: #1976d2; margin: 0 0 15px 0; font-size: 18px;\"&gt;üìû Need Assistance? Contact Us:&lt;/h3&gt;"
    body_html += f"&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üìß Email:&lt;/strong&gt; &lt;a href=\"mailto:{company_email}\" style=\"color: #1976d2; text-decoration: none;\"&gt;{company_email}&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;p style=\"margin: 8px 0; color: #333;\"&gt;&lt;strong&gt;üì± Mobile:&lt;/strong&gt; &lt;a href=\"tel:0762682176\" style=\"color: #1976d2; text-decoration: none;\"&gt;0762682176&lt;/a&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;"
    body_html += "&lt;tr&gt;&lt;td style=\"background-color: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #dee2e6;\"&gt;"
    body_html += f"&lt;p style=\"color: #6c757d; font-size: 14px; margin: 0;\"&gt;Best regards,&lt;br/&gt;&lt;strong&gt;{company_name} Team&lt;/strong&gt;&lt;/p&gt;"
    body_html += "&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"

# Open email composer with pre-built content
action = {
    'type': 'ir.actions.act_window',
    'name': 'Send Reminder Email',
    'res_model': 'mail.compose.message',
    'view_mode': 'form',
    'target': 'new',
    'context': {
        'default_model': 'project.hosting',
        'default_res_ids': [hosting.id],
        'default_partner_ids': [(6, 0, [hosting.client_id.id])],
        'default_subject': subject,
        'default_body': body_html,
        'default_email_from': company_email,
        'default_email_to': hosting.client_id.email,
        'default_composition_mode': 'comment',
    }
}
            </field>
        </record>
    </data>
</odoo>
