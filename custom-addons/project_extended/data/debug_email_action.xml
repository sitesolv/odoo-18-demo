<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Debug Email System Action -->
        <record id="action_debug_email_system" model="ir.actions.server">
            <field name="name">Debug Email System</field>
            <field name="model_id" ref="model_project_domain"/>
            <field name="binding_model_id" ref="model_project_domain"/>
            <field name="state">code</field>
            <field name="code">
# Check email templates
try:
    template1 = env.ref('project_extended.email_template_domain_expiring_client')
    template2 = env.ref('project_extended.email_template_domain_expired_client')
    template3 = env.ref('project_extended.email_template_hosting_expiring_client')
    template4 = env.ref('project_extended.email_template_hosting_expired_client')
    
    templates_found = [template1.name, template2.name, template3.name, template4.name]
    
    # Check configuration
    auto_send = env['ir.config_parameter'].sudo().get_param('project_extended.auto_send_emails', 'True')
    email_config = env['ir.config_parameter'].sudo().get_param('project_extended.expiry_notification_email', 'Not Set')
    
    # Check outgoing mail server
    mail_server = env['ir.mail_server'].search([], limit=1)
    
    message = f"""
EMAIL SYSTEM DEBUG REPORT:
=========================

‚úÖ Templates Found: {len(templates_found)}/4
{chr(10).join([f"- {t}" for t in templates_found])}

‚öôÔ∏è Configuration:
- Auto Send Emails: {auto_send}
- Notification Email: {email_config}
- Mail Server: {'Configured' if mail_server else 'NOT CONFIGURED'}

üìß Test with first record:
"""
    
    if records:
        record = records[0]
        message += f"""
- Domain: {record.name}
- Client: {record.client_id.name}
- Client Email: {record.client_id.email or 'NO EMAIL'}
- Expiry Status: {record.expiry_status}
"""
        
        # Try to send test email
        if record.client_id.email:
            try:
                result = record._send_client_email(record, 'warning')
                message += f"- Test Email Result: {result}"
            except Exception as e:
                message += f"- Test Email Error: {str(e)}"
        else:
            message += "- Cannot test: No client email"
    
    raise UserError(message)
    
except Exception as e:
    raise UserError(f"Debug Error: {str(e)}")
            </field>
        </record>
    </data>
</odoo>
