<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="dashboard_template" name="Project Financial Dashboard">
        <t t-call="web.html_container">
            <div class="container-fluid o_view_manager_content">
                <div class="o_content">
                    <!-- Dashboard Header -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <h1 class="mb-0">
                                    <i class="fa fa-dashboard"/> Project Financial Dashboard
                                </h1>
                                <div class="text-muted">
                                    <i class="fa fa-calendar"/> Dashboard
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Company Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title">Total Income</h4>
                                            <h2><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['total_income'])"/></h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fa fa-arrow-up fa-3x opacity-75"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title">Total Expenses</h4>
                                            <h2><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['total_expense'])"/></h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fa fa-arrow-down fa-3x opacity-75"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div t-att-class="'card text-white ' + ('bg-success' if company_summary['net_profit'] >= 0 else 'bg-danger')">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title">Net Profit</h4>
                                            <h2><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['net_profit'])"/></h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fa fa-money fa-3x opacity-75"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title">Profit Margin</h4>
                                            <h2><t t-esc="'{:.1f}'.format(company_summary['profit_margin'])"/>%</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fa fa-percent fa-3x opacity-75"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Company Status -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Company Status: </strong>
                                        <span t-att-class="company_summary['status_class']">
                                            <t t-esc="company_summary['status']"/>
                                        </span>
                                        <span class="ml-3">
                                            <strong>Active Projects: </strong><t t-esc="company_summary['project_count']"/>
                                        </span>
                                    </div>
                                    <div>
                                        <button class="btn btn-primary btn-sm" onclick="window.location.reload()">
                                            <i class="fa fa-refresh"/> Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Projects Table -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fa fa-table"/> Project Financial Summary
                                    </h3>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover mb-0">
                                            <thead class="thead-dark">
                                                <tr>
                                                    <th>Project Name</th>
                                                    <th>Client</th>
                                                    <th class="text-right">Income</th>
                                                    <th class="text-right">Expenses</th>
                                                    <th class="text-right">Net Profit</th>
                                                    <th class="text-right">Margin %</th>
                                                    <th class="text-center">Status</th>
                                                    <th class="text-center">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="projects" t-as="project">
                                                    <tr>
                                                        <td>
                                                            <strong><t t-esc="project['name']"/></strong>
                                                        </td>
                                                        <td>
                                                            <t t-esc="project['client']"/>
                                                        </td>
                                                        <td class="text-right text-success">
                                                            <t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(project['total_income'])"/>
                                                        </td>
                                                        <td class="text-right text-warning">
                                                            <t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(project['total_expense'])"/>
                                                        </td>
                                                        <td t-att-class="'text-right ' + ('text-success' if project['net_profit'] >= 0 else 'text-danger')">
                                                            <strong>
                                                                <t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(project['net_profit'])"/>
                                                            </strong>
                                                        </td>
                                                        <td class="text-right">
                                                            <t t-esc="'{:.1f}'.format(project['profit_margin'])"/>%
                                                        </td>
                                                        <td class="text-center">
                                                            <span t-att-class="'badge ' + ('badge-success' if project['status'] == 'Profitable' else 'badge-danger' if project['status'] == 'Loss' else 'badge-warning')">
                                                                <t t-esc="project['status']"/>
                                                            </span>
                                                        </td>
                                                        <td class="text-center">
                                                            <div class="btn-group btn-group-sm">
                                                                <a t-attf-href="/web#model=project.income&amp;view_type=list&amp;domain=[('project_id','=',{{project['id']}})]" class="btn btn-outline-success btn-sm">
                                                                    <i class="fa fa-arrow-up"/> Income
                                                                </a>
                                                                <a t-attf-href="/web#model=project.expense&amp;view_type=list&amp;domain=[('project_id','=',{{project['id']}})]" class="btn btn-outline-warning btn-sm">
                                                                    <i class="fa fa-arrow-down"/> Expenses
                                                                </a>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </t>
                                                <t t-if="not projects">
                                                    <tr>
                                                        <td colspan="8" class="text-center text-muted py-5">
                                                            <i class="fa fa-info-circle"/> No active projects found
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                            <tfoot t-if="projects" class="thead-light">
                                                <tr>
                                                    <th colspan="2"><strong>TOTALS</strong></th>
                                                    <th class="text-right text-success">
                                                        <strong><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['total_income'])"/></strong>
                                                    </th>
                                                    <th class="text-right text-warning">
                                                        <strong><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['total_expense'])"/></strong>
                                                    </th>
                                                    <th t-att-class="'text-right ' + ('text-success' if company_summary['net_profit'] >= 0 else 'text-danger')">
                                                        <strong><t t-esc="currency_symbol"/><t t-esc="'{:,.2f}'.format(company_summary['net_profit'])"/></strong>
                                                    </th>
                                                    <th class="text-right">
                                                        <strong><t t-esc="'{:.1f}'.format(company_summary['profit_margin'])"/>%</strong>
                                                    </th>
                                                    <th class="text-center">
                                                        <span t-att-class="'badge ' + ('badge-success' if company_summary['status'] == 'Profitable' else 'badge-danger' if company_summary['status'] == 'Loss' else 'badge-warning')">
                                                            <t t-esc="company_summary['status']"/>
                                        </span>
                                                    </th>
                                                    <th class="text-center">
                                                        <small class="text-muted"><t t-esc="company_summary['project_count']"/> projects</small>
                                                    </th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
